import com.google.common.testing.TestLogHandler;
import io.cloudevents.CloudEvent;
import io.cloudevents.core.builder.CloudEventBuilder;
import org.junit.BeforeClass;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.JUnit4;

import java.net.URI;
import java.nio.charset.StandardCharsets;
import java.util.logging.Logger;

import static com.google.common.truth.Truth.assertThat;

@RunWith(JUnit4.class)
public class EmailValidatorFunctionTest {
  private static final Logger logger = Logger.getLogger(EmailValidatorFunction.class.getName());
  private static final TestLogHandler logHandler = new TestLogHandler();

  @BeforeClass
  public static void beforeClass() {
    logger.addHandler(logHandler);
  }

  @Test
  public void functionsPubsubSubscribe_shouldPrintPubsubMessage() {
    String message = "{\"message\":{\"attributes\":{\"googclient_schemaencoding\":\"BINARY\",\"googclient_schemarevisionid\":\"875f1962\"},\"data\":\"bHV0bHlzbmluZ2VyK2JuY0JEU0tEQVcyUklCUkJPR0dYV1JRTUdRRVlRSkRJUEFAanByby5ubwIudXRseXNuaW5nZXJAbWFpbC5jcjMubWUA9KcBUmVjZWl2ZWQ6IGJ5IG1haWwtZWQxLWY2OS5nb29nbGUuY29tIHdpdGggU01UUCBpZCA0ZmI0ZDdmNDVkMWNmLTUxMGY2ZTM5ZjVhc2YxNDI3NzcwYTEyLjAKICAgICAgICBmb3IgPHV0bHlzbmluZ2VyQG1haWwuY3IzLm1lPjsgVGh1LCAyNSBNYXkgMjAyMyAwNjozMTozNyAtMDcwMCAoUERUKQpBUkMtU2VhbDogaT0yOyBhPXJzYS1zaGEyNTY7IHQ9MTY4NTAyMTQ5NzsgY3Y9cGFzczsKICAgICAgICBkPWdvb2dsZS5jb207IHM9YXJjLTIwMTYwODE2OwogICAgICAgIGI9MCtiM09SVit1d1krb3RhUE5LQnlEalFESkFZRmNsN2U3djRRbmVkNzM4bTJiTzBmdE9rWDNRU2VrVXd0SW1wMWcvCiAgICAgICAgIFpwcVVCakhzL01jNHlPYUt5enAxdVZDbG51cmc5K1I0VkxDNUxMTllxY1pnK1FlaGlCS2p3RDlWQ0kxNW1DRStmR05TCiAgICAgICAgIEVScmh5dkE5ZE5ua29YSGc3NDBXaTFvNWdjR3AyZkxKTEIrUzh0emlFL25TeEFBTTQrSkdNTkxaaTVGeDBVbDJNSnhKCiAgICAgICAgIGdWSVZmOWFEVmdqVzU5SFhObDBQOGUrelY3aE5NT1N3bFJnUnNuM2lmSWRwT2dIdVZyZ29HWU41SS9RaE5wbkNmdjVICiAgICAgICAgIGtDWWRLRXNIc0ljWHQwQ1B4SnBUeHVlOCt0RDdzUzZvaUt2eFNVYmc1U084YWVDWTVmbFo4Ly9KbjVOMkVEMU9xc1VkCiAgICAgICAgIG9WdGc9PQpBUkMtTWVzc2FnZS1TaWduYXR1cmU6IGk9MjsgYT1yc2Etc2hhMjU2OyBjPXJlbGF4ZWQvcmVsYXhlZDsgZD1nb29nbGUuY29tOyBzPWFyYy0yMDE2MDgxNjsKICAgICAgICBoPWxpc3QtdW5zdWJzY3JpYmU6bGlzdC1zdWJzY3JpYmU6bGlzdC1hcmNoaXZlOmxpc3QtaGVscDpsaXN0LXBvc3QKICAgICAgICAgOmxpc3QtaWQ6bWFpbGluZy1saXN0OnByZWNlZGVuY2U6dG86c3ViamVjdDptZXNzYWdlLWlkOmRhdGU6ZnJvbQogICAgICAgICA6bWltZS12ZXJzaW9uOmRraW0tc2lnbmF0dXJlOwogICAgICAgIGJoPXdkdVRkbWpuZENLYnZUMXFPbW9nS213TmxBVHpMRWYzVEhZY3NQMUJBd289OwogICAgICAgIGI9a2dEanRnYmdlL0pjZis2Tlp6enVya0dlSkNkR21HaFFNdmZmMXV0QnMvaXQ3YStBcDJDU3ZXV1FhMGkyU0cvUExyCiAgICAgICAgIFdTNEVGdS9reGJQSk5ZK1EyYW5GOUVVc3NLWXBZNTlwdENtRGhueENBOFAvNnhNRWpPa0lLU2lZQnEzc3FFb3Y2b0lNCiAgICAgICAgIHVqMUtVYWl6Wk15REl4WHU1VHVPWG9RZm1IRUVMU2NpYitwMXJYNldWdkxvZFI3bDZBMU94OG1tUE5MSzZScHNBV0hqCiAgICAgICAgIDNvOVVDU24wMm9ycnJoYldWTVhMdExLQStvSGlMTnZGT3hlL0N0NnhiWkRJaWxWcEdTeGxEY25GRkZqSnhyYnRTVHlJCiAgICAgICAgIFB0WS9Pekh1Z2hCaDdIU2EwaGJuM29KcGdVNUZJQ3lqcGxqdzkydlJKa094R2xjSmJqOXh2cGtjTUxVM2NWQVdXam5ECiAgICAgICAgIDRIRkE9PQpBUkMtQXV0aGVudGljYXRpb24tUmVzdWx0czogaT0yOyBteC5nb29nbGUuY29tOwogICAgICAgZGtpbT1wYXNzIGhlYWRlci5pPUBqcHJvLm5vIGhlYWRlci5zPWdvb2dsZSBoZWFkZXIuYj0iTGtvMEt3by8iOwogICAgICAgc3BmPXBhc3MgKGdvb2dsZS5jb206IGRvbWFpbiBvZiBicmFtQGpwcm8ubm8gZGVzaWduYXRlcyAyMDkuODUuMjIwLjQxIGFzIHBlcm1pdHRlZCBzZW5kZXIpIHNtdHAubWFpbGZyb209YnJhbUBqcHJvLm5vOwogICAgICAgZG1hcmM9cGFzcyAocD1OT05FIHNwPU5PTkUgZGlzPU5PTkUpIGhlYWRlci5mcm9tPWpwcm8ubm8KREtJTS1TaWduYXR1cmU6IHY9MTsgYT1yc2Etc2hhMjU2OyBjPXJlbGF4ZWQvcmVsYXhlZDsKICAgICAgICBkPWpwcm8ubm87IHM9Z29vZ2xlOyB0PTE2ODUwMjE0OTc7IHg9MTY4NzYxMzQ5NzsKICAgICAgICBoPWxpc3QtdW5zdWJzY3JpYmU6bGlzdC1zdWJzY3JpYmU6bGlzdC1hcmNoaXZlOmxpc3QtaGVscDpsaXN0LXBvc3QKICAgICAgICAgOmxpc3QtaWQ6bWFpbGluZy1saXN0OnByZWNlZGVuY2U6eC1vcmlnaW5hbC1hdXRoZW50aWNhdGlvbi1yZXN1bHRzCiAgICAgICAgIDp4LW9yaWdpbmFsLXNlbmRlcjp0bzpzdWJqZWN0Om1lc3NhZ2UtaWQ6ZGF0ZTpmcm9tOm1pbWUtdmVyc2lvbjpmcm9tCiAgICAgICAgIDp0bzpjYzpzdWJqZWN0OmRhdGU6bWVzc2FnZS1pZDpyZXBseS10bzsKICAgICAgICBiaD13ZHVUZG1qbmRDS2J2VDFxT21vZ0ttd05sQVR6TEVmM1RIWWNzUDFCQXdvPTsKICAgICAgICBiPVhRZjRUMnNORzdSWld6eUNFUFNaNnVBdGJFOXFja1N1WDJCd0t2OCtLOTlHQ2orTThzcTF4V3Z0amlWc3JIb1ZLSwogICAgICAgICBKWitXYTNhZWxRYUljRjI1aks3bVBHWU42bmUyVkFZVGR4WDVsRUs0dThqSHpsMHFIV1dYS2VWSXZIRTBnbVVPT0hTaQogICAgICAgICBZaHY4UlVaVHZqOVNiRXdkaTNOaDQ0aFdFK0o3NDJhN281MU84PQpYLUdvb2dsZS1ES0lNLVNpZ25hdHVyZTogdj0xOyBhPXJzYS1zaGEyNTY7IGM9cmVsYXhlZC9yZWxheGVkOwogICAgICAgIGQ9MWUxMDAubmV0OyBzPTIwMjIxMjA4OyB0PTE2ODUwMjE0OTc7IHg9MTY4NzYxMzQ5NzsKICAgICAgICBoPWxpc3QtdW5zdWJzY3JpYmU6bGlzdC1zdWJzY3JpYmU6bGlzdC1hcmNoaXZlOmxpc3QtaGVscDpsaXN0LXBvc3QKICAgICAgICAgOngtc3BhbS1jaGVja2VkLWluLWdyb3VwOmxpc3QtaWQ6bWFpbGluZy1saXN0OnByZWNlZGVuY2UKICAgICAgICAgOngtb3JpZ2luYWwtYXV0aGVudGljYXRpb24tcmVzdWx0czp4LW9yaWdpbmFsLXNlbmRlcjp0bzpzdWJqZWN0CiAgICAgICAgIDptZXNzYWdlLWlkOmRhdGU6ZnJvbTptaW1lLXZlcnNpb246eC1iZWVudGhlcmU6eC1nbS1tZXNzYWdlLXN0YXRlCiAgICAgICAgIDpmcm9tOnRvOmNjOnN1YmplY3Q6ZGF0ZTptZXNzYWdlLWlkOnJlcGx5LXRvOwogICAgICAgIGJoPXdkdVRkbWpuZENLYnZUMXFPbW9nS213TmxBVHpMRWYzVEhZY3NQMUJBd289OwogICAgICAgIGI9TW83NGdUdldpMDNYK2hkKzFHZ3VieVpHQzlpYmJIcmJMcWdXQjVWQVpDMjMwcUk0YVozL2t6eFBrTStXa3MySWhzCiAgICAgICAgIFRiUjg0WURoVWxuWHp3WVR1T25rY1VtZ0p1Sks4cGUxSUpwRGdtQU52R2pCU2d6TWE3aDRYQVloM051QjZteGx3akFoCiAgICAgICAgICtGQW43aHdPN3hqdWNaVXp1U1VWYmZKNDkycjBhb2JmaDB5UnRzdS85NGxZVlNXaytOZjcvLzhobXZkV2h2Qjd2V1QzCiAgICAgICAgIEM3bUN0Ym1IN2pTNUd3OVFRMEl5WC9KdEZOUDNYUEowSjZJZk10a2JUQUxFRTg2VEc1UWRCVVE3UlJ5YUwxOHNsU0NnCiAgICAgICAgIFZLK1JmLy84WWV3S2MzNTRERVdxSjRmN3NVdytTTkFwRTVIUzVYVlVIcEZMckR3MERDUjJoUldqeWxxS0RxSFdFcGowCiAgICAgICAgIHd0WHc9PQpYLUdtLU1lc3NhZ2UtU3RhdGU6IEFDK1ZmRHlaU3Rxa3ZwT3ZkWDduTXFJbDd6bUpzcHpPSW1pMDFFOFVPdVdiaUFhcGNTSlRWUWs4CglVMis2OGQ3b250OEFiWjI3Z0FJaGVJVWxEUT09ClgtR29vZ2xlLVNtdHAtU291cmNlOiBBQ0hIVVo0QXdmZzlUV2EvMVYzbENIbDNNZ3krTmE0eGtjanU4YlgvMFYwOWJFQWZlM3IzRmZ5MWVQdlF0VklxTkxwKzZONEkyNS9oUXc9PQpYLVJlY2VpdmVkOiBieSAyMDAyOmFhNzpkNDRjOjA6YjA6NTE0OjIyNGI6YTQ4YyB3aXRoIFNNVFAgaWQgcTEyLTIwMDIwYWE3ZDQ0YzAwMDAwMGIwMDUxNDIyNGJhNDhjbXIyNjgzMDk5ZWRyLjAuMTY4NTAyMTQ5NjkxMTsKICAgICAgICBUaHUsIDI1IE1heSAyMDIzIDA2OjMxOjM2IC0wNzAwIChQRFQpClgtQmVlblRoZXJlOiB1dGx5c25pbmdlckBqcHJvLm5vClJlY2VpdmVkOiBieSAyMDAyOmE1MDplYzkyOjA6YjA6NTEzOmVkZTU6NjRkNCB3aXRoIFNNVFAgaWQgZTE4LTIwMDIwYTUwZWM5MjAwMDAwMGIwMDUxM2VkZTU2NGQ0bHMyNDMwMTVlZHIuMC4tcG9kLXByb2QtMDAtZXU7CiBUaHUsIDI1IE1heSAyMDIzIDA2OjMxOjM1IC0wNzAwIChQRFQpClgtUmVjZWl2ZWQ6IGJ5IDIwMDI6YTE3OjkwNzoyZDFlOmIwOjk2OTo5YzBjOjRjOTcgd2l0aCBTTVRQIGlkIGdzMzAtMjAwMjBhMTcwOTA3MmQxZTAwYjAwOTY5OWMwYzRjOTdtcjE1MzE4MDllamMuMS4xNjg1MDIxNDk1NTYxOwogICAgICAgIFRodSwgMjUgTWF5IDIwMjMgMDY6MzE6MzUgLTA3MDAgKFBEVCkKQVJDLVNlYWw6IGk9MTsgYT1yc2Etc2hhMjU2OyB0PTE2ODUwMjE0OTU7IGN2PW5vbmU7CiAgICAgICAgZD1nb29nbGUuY29tOyBzPWFyYy0yMDE2MDgxNjsKICAgICAgICBiPWcyL0t6cmwrYkd0c2pQYU5WREhkNWxIeG55NUFHODdUdk0wdFA3MjRsZkRVeU0yVU5CTWxsSDlDdWlmcmVlSzJESAogICAgICAgICBhL0NocTFpRDJhRjdLZ1pxRzZMNFp2RmVuOVNkVTVRZ21BemVHTW4zWXBaamE5QjM3c05EZ3VTeldzL0hlRFJzcjBNUAogICAgICAgICA2OHUyZkdnK0thdnFaUk9BcVJXa01nSDBSeUpIVUxZVmRKblhIOS9MK0licy9vbG13YU9XM2llRWxEVUNVUFpYd2ZRQQogICAgICAgICBMRnhhMWJYbkZRQVQ0V29ocmhlb1VaU05XSktGNlpPREtFM05TUlJOK2VTYno4Rk8yc0J4VVkzcS9MUFg3S2NWZTZRMgogICAgICAgICBrQWNwQVIwTzBqSU51U3YydXpnTGhqajdMZ3RwRWdFV3hjMnV6VVNIK3VuNDBnRm5VTmxyZ0lBbVhqbU9UQU1FYUExdwogICAgICAgICB2MVFRPT0KQVJDLU1lc3NhZ2UtU2lnbmF0dXJlOiBpPTE7IGE9cnNhLXNoYTI1NjsgYz1yZWxheGVkL3JlbGF4ZWQ7IGQ9Z29vZ2xlLmNvbTsgcz1hcmMtMjAxNjA4MTY7CiAgICAgICAgaD10bzpzdWJqZWN0Om1lc3NhZ2UtaWQ6ZGF0ZTpmcm9tOm1pbWUtdmVyc2lvbjpka2ltLXNpZ25hdHVyZTsKICAgICAgICBiaD1qb3hEOTZ5akFWTXZlTmVFakJqVGsxdVQrc1lock1oVW4rWlBzWVJ0TVdBPTsKICAgICAgICBiPW1ZZHJmREFqUFFhWE1zUnFUazBrdm5BZjY5aU9KKzQzcTF5QkVtN0s3d1FOK1BuWXpDdzdwOE5MaitXK3FhdUVIdgogICAgICAgICBjeXQ0V0hQWTVLeUNITU94NEROUTZvOHVYQzl4R3ZLeEF6NWZNSFlHWFpKZXpmQVgrTld6c0pPRW5HQ25ncVNaRkNyWAogICAgICAgICA4dFA1QWQvZ25MQ0JwUUdVcGF2RGRxSWtja0lsWVdtbFNQRmhsWWhEVHN2WGN0a3paZk5XdlNqcWR2OEhwNzUrVkhoVwogICAgICAgICAxTXVRaVhFYXlUNTZlU0twNm9NTTdtM09FYUVxN1dVcCtHelpWbmNXaG1aN09ycTlrZG1ra1RFQUkxdmJreUFxMU1TWgogICAgICAgICA5ZVRDbWtjVTFxV1pPbEFVb0MrbkNKNE01R3QyekVTNjJSTGtsTS83RUVnTFpFYVpkNGFYSEQ4M3V0NFVIQis1ZFljdgogICAgICAgICB0c1RBPT0KQVJDLUF1dGhlbnRpY2F0aW9uLVJlc3VsdHM6IGk9MTsgbXguZ29vZ2xlLmNvbTsKICAgICAgIGRraW09cGFzcyBoZWFkZXIuaT1AanByby5ubyBoZWFkZXIucz1nb29nbGUgaGVhZGVyLmI9IkxrbzBLd28vIjsKICAgICAgIHNwZj1wYXNzIChnb29nbGUuY29tOiBkb21haW4gb2YgYnJhbUBqcHJvLm5vIGRlc2lnbmF0ZXMgMjA5Ljg1LjIyMC40MSBhcyBwZXJtaXR0ZWQgc2VuZGVyKSBzbXRwLm1haWxmcm9tPWJyYW1AanByby5ubzsKICAgICAgIGRtYXJjPXBhc3MgKHA9Tk9ORSBzcD1OT05FIGRpcz1OT05FKSBoZWFkZXIuZnJvbT1qcHJvLm5vClJlY2VpdmVkOiBmcm9tIG1haWwtc29yLWY0MS5nb29nbGUuY29tIChtYWlsLXNvci1mNDEuZ29vZ2xlLmNvbS4gWzIwOS44NS4yMjAuNDFdKQogICAgICAgIGJ5IG14Lmdvb2dsZS5jb20gd2l0aCBTTVRQUyBpZCB1MTQtMjAwMjBhMTcwOTA2YjEwZTAwYjAwOTRmNzM1YzgyYWJzb3IyNzY0NTg0ZWp5LjIuMjAyMy4wNS4yNS4wNi4zMS4zNQogICAgICAgIGZvciA8dXRseXNuaW5nZXJAanByby5ubz4KICAgICAgICAoR29vZ2xlIFRyYW5zcG9ydCBTZWN1cml0eSk7CiAgICAgICAgVGh1LCAyNSBNYXkgMjAyMyAwNjozMTozNSAtMDcwMCAoUERUKQpSZWNlaXZlZC1TUEY6IHBhc3MgKGdvb2dsZS5jb206IGRvbWFpbiBvZiBicmFtQGpwcm8ubm8gZGVzaWduYXRlcyAyMDkuODUuMjIwLjQxIGFzIHBlcm1pdHRlZCBzZW5kZXIpIGNsaWVudC1pcD0yMDkuODUuMjIwLjQxOwpYLVJlY2VpdmVkOiBieSAyMDAyOmExNzo5MDc6OTZhYTpiMDo5NzM6ODdkMzo4MGQ0IHdpdGggU01UUCBpZAogaGQ0Mi0yMDAyMGExNzA5MDc5NmFhMDBiMDA5NzM4N2QzODBkNG1yMTQ1MTUyMGVqYy4xOC4xNjg1MDIxNDk1MDM4OyBUaHUsIDI1CiBNYXkgMjAyMyAwNjozMTozNSAtMDcwMCAoUERUKQpNSU1FLVZlcnNpb246IDEuMApGcm9tOiBCcmFtIEJlemVtIDxicmFtQGpwcm8ubm8+CkRhdGU6IFRodSwgMjUgTWF5IDIwMjMgMTU6MzA6NTkgKzAyMDAKTWVzc2FnZS1JRDogPENBRjJ3ZWZyX0d2cVpzT2dnV1pQT2ZiOEtxTFZZbnl6b2tGZTYyPXFVQ3MrSjM3K2JqQUBtYWlsLmdtYWlsLmNvbT4KU3ViamVjdDogVGVzdApUbzogdXRseXNuaW5nZXIgPHV0bHlzbmluZ2VyQGpwcm8ubm8+CkNvbnRlbnQtVHlwZTogbXVsdGlwYXJ0L2FsdGVybmF0aXZlOyBib3VuZGFyeT0iMDAwMDAwMDAwMDAwYTZhOTQ3MDVmYzg0YTNiMiIKWC1PcmlnaW5hbC1TZW5kZXI6IGJyYW1AanByby5ubwpYLU9yaWdpbmFsLUF1dGhlbnRpY2F0aW9uLVJlc3VsdHM6IG14Lmdvb2dsZS5jb207ICAgICAgIGRraW09cGFzcwogaGVhZGVyLmk9QGpwcm8ubm8gaGVhZGVyLnM9Z29vZ2xlIGhlYWRlci5iPSJMa28wS3dvLyI7ICAgICAgIHNwZj1wYXNzCiAoZ29vZ2xlLmNvbTogZG9tYWluIG9mIGJyYW1AanByby5ubyBkZXNpZ25hdGVzIDIwOS44NS4yMjAuNDEgYXMgcGVybWl0dGVkCiBzZW5kZXIpIHNtdHAubWFpbGZyb209YnJhbUBqcHJvLm5vOyAgICAgICBkbWFyYz1wYXNzIChwPU5PTkUgc3A9Tk9ORQogZGlzPU5PTkUpIGhlYWRlci5mcm9tPWpwcm8ubm8KUHJlY2VkZW5jZTogbGlzdApNYWlsaW5nLWxpc3Q6IGxpc3QgdXRseXNuaW5nZXJAanByby5ubzsgY29udGFjdCB1dGx5c25pbmdlcitvd25lcnNAanByby5ubwpMaXN0LUlEOiA8dXRseXNuaW5nZXIuanByby5ubz4KWC1TcGFtLUNoZWNrZWQtSW4tR3JvdXA6IHV0bHlzbmluZ2VyQGpwcm8ubm8KWC1Hb29nbGUtR3JvdXAtSWQ6IDY3NzEyMDQ2MTQ4Ckxpc3QtUG9zdDogPGh0dHBzOi8vZ3JvdXBzLmdvb2dsZS5jb20vYS9qcHJvLm5vL2dyb3VwL3V0bHlzbmluZ2VyL3Bvc3Q+LCA8bWFpbHRvOnV0bHlzbmluZ2VyQGpwcm8ubm8+Ckxpc3QtSGVscDogPGh0dHBzOi8vc3VwcG9ydC5nb29nbGUuY29tL2EvanByby5uby9iaW4vdG9waWMucHk/dG9waWM9MjU4Mzg+LCA8bWFpbHRvOnV0bHlzbmluZ2VyK2hlbHBAanByby5ubz4KTGlzdC1BcmNoaXZlOiA8aHR0cHM6Ly9ncm91cHMuZ29vZ2xlLmNvbS9hL2pwcm8ubm8vZ3JvdXAvdXRseXNuaW5nZXIvPgpMaXN0LVN1YnNjcmliZTogPGh0dHBzOi8vZ3JvdXBzLmdvb2dsZS5jb20vYS9qcHJvLm5vL2dyb3VwL3V0bHlzbmluZ2VyL3N1YnNjcmliZT4sCiA8bWFpbHRvOnV0bHlzbmluZ2VyK3N1YnNjcmliZUBqcHJvLm5vPgpMaXN0LVVuc3Vic2NyaWJlOiA8bWFpbHRvOmdvb2dsZWdyb3Vwcy1tYW5hZ2UrNjc3MTIwNDYxNDgrdW5zdWJzY3JpYmVAZ29vZ2xlZ3JvdXBzLmNvbT4sCiA8aHR0cHM6Ly9ncm91cHMuZ29vZ2xlLmNvbS9hL2pwcm8ubm8vZ3JvdXAvdXRseXNuaW5nZXIvc3Vic2NyaWJlPgoKLS0wMDAwMDAwMDAwMDBhNmE5NDcwNWZjODRhM2IyCkNvbnRlbnQtVHlwZTogdGV4dC9wbGFpbjsgY2hhcnNldD0iVVRGLTgiCgpUZXN0CkJyYW0gQmV6ZW0gKlNlbmlvcmtvbnN1bGVudCogW2ltYWdlOiBMb2dvXQp0OiAoKzQ3KSA5MDIgNzYgMDg0CmU6ICogYnJhbUBqcHJvLm5vIDxicmFtQGpwcm8ubm8+ICogSlByb2Zlc3Npb25hbHMgQVMKKiBqcHJvLm5vIDxodHRwczovL2pwcm8ubm8+ICoKCi0tIApZb3UgcmVjZWl2ZWQgdGhpcyBtZXNzYWdlIGJlY2F1c2UgeW91IGFyZSBzdWJzY3JpYmVkIHRvIHRoZSBHb29nbGUgR3JvdXBzICJ1dGx5c25pbmdlciIgZ3JvdXAuClRvIHVuc3Vic2NyaWJlIGZyb20gdGhpcyBncm91cCBhbmQgc3RvcCByZWNlaXZpbmcgZW1haWxzIGZyb20gaXQsIHNlbmQgYW4gZW1haWwgdG8gdXRseXNuaW5nZXIrdW5zdWJzY3JpYmVAanByby5uby4KCi0tMDAwMDAwMDAwMDAwYTZhOTQ3MDVmYzg0YTNiMgpDb250ZW50LVR5cGU6IHRleHQvaHRtbDsgY2hhcnNldD0iVVRGLTgiCkNvbnRlbnQtVHJhbnNmZXItRW5jb2Rpbmc6IHF1b3RlZC1wcmludGFibGUKCjxkaXYgZGlyPTNEImx0ciI+VGVzdDxiciBjbGVhcj0zRCJhbGwiPjxkaXY+PGRpdj48ZGl2IGRpcj0zRCJsdHIiIGNsYXNzPTNEIj0KZ21haWxfc2lnbmF0dXJlIiBkYXRhLXNtYXJ0bWFpbD0zRCJnbWFpbF9zaWduYXR1cmUiPjxkaXYgZGlyPTNEImx0ciI+CiAgICAgICA9MjAKICAgICAgICAgICAgPHRhYmxlIHN0eWxlPTNEIndpZHRoOjQ1MHB4O2ZvbnQtZmFtaWx5OlZlcmRhbmEsc2Fucy1zZXJpZjtjb2xvPQpyOiMzMzMzMzMiIHdpZHRoPTNEIjQ1MCIgY2VsbHNwYWNpbmc9M0QiMCIgY2VsbHBhZGRpbmc9M0QiMCI+PHRib2R5IHN0eWxlPQo9M0QidmVydGljYWwtYWxpZ246dG9wIj48dHI+CiAgICAgICAgICAgICAgICA8dGQgc3R5bGU9M0QiYm9yZGVyLWJvdHRvbToxcHggc29saWQ7Ym9yZGVyLWJvdHRvbS1jb2xvcjojZj0KZjdhMGM7cGFkZGluZy1ib3R0b206MTBweDtwYWRkaW5nLXRvcDoxMHB4O3BhZGRpbmctbGVmdDowO3BhZGRpbmctcmlnaHQ6MDt2PQplcnRpY2FsLWFsaWduOmJvdHRvbSIgdmFsaWduPTNEImJvdHRvbSI+CiAgICAgICAgICAgICAgICAgICAgPGgzIGNvbG9yPTNEIiMzMzMzMzMiIHN0eWxlPTNEIm1hcmdpbi1ib3R0b206NXB4O2ZvbnQtcz0KaXplOjE0cHQ7Y29sb3I6I2ZmN2EwYyI+QnJhbSBCZXplbTwvaDM+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9M0QiZm9udC1zaXplOjEwcHQiPjxiPlNlbmlvcmtvbnN1bGVudDwvYj48Lz0Kc3Bhbj4KICAgICAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgICAgICAgICA8dGQgc3R5bGU9M0QiYm9yZGVyLWJvdHRvbToxcHggc29saWQ7Ym9yZGVyLWJvdHRvbS1jb2xvcjojZj0KZjdhMGM7cGFkZGluZy1sZWZ0OjA7cGFkZGluZy1yaWdodDowO3ZlcnRpY2FsLWFsaWduOm1pZGRsZSIgdmFsaWduPTNEInRvcCI+CiAgICAgICAgICAgICAgICAgICAgPGltZyBhbHQ9M0QiTG9nbyIgdGl0bGU9M0QiTG9nbyIgc3JjPTNEImh0dHBzOi8vanByby5ubz0KL2ltYWdlcy9ncmFmaXNrL1NpZ25hdHVyTG9nby5wbmciIHdpZHRoPTNEImF1dG8iIGhlaWdodD0zRCI1NCI+CiAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICA8L3RyPgogICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgICA8dGQgc3R5bGU9M0Qid2lkdGg6NzAlO3BhZGRpbmctdG9wOjEwcHg7cGFkZGluZy1ib3R0b206MDtwYT0KZGRpbmctbGVmdDowO3BhZGRpbmctcmlnaHQ6MDtsaW5lLWhlaWdodDoxOHB4O3ZlcnRpY2FsLWFsaWduOnRvcCIgd2lkdGg9M0QiPQo3MCUiIHZhbGlnbj0zRCJ0b3AiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPTNEImZvbnQtc2l6ZToxMHB0Ij50OiAoKzQ3KSA8c3BhbiBzdHlsZT0zRCI9CmZvbnQtc2l6ZToxMHB0Ij45MDIgNzYgMDg0PC9zcGFuPjwvc3Bhbj48YnI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9M0QiZm9udC1zaXplOjEwcHQiPmU6IDxiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0zRCJtYWlsdG86YnJhbUBqcHJvLm5vIiBjb2xvcj0zRCIjMDAwMDA9CjAiIHJlbD0zRCJub29wZW5lciIgc3R5bGU9M0QidGV4dC1kZWNvcmF0aW9uOm5vbmU7Y29sb3I6I2ZmN2EwYyIgdGFyZ2V0PTNEIj0KX2JsYW5rIj5icmFtQGpwcm8ubm88L2E+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvYj48L3NwYW4+CiAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICAgICAgPHRkIHN0eWxlPTNEIndpZHRoOjMwJTtwYWRkaW5nLXRvcDoxMHB4O3BhZGRpbmctYm90dG9tOjA7cGE9CmRkaW5nLWxlZnQ6MDtwYWRkaW5nLXJpZ2h0OjA7bGluZS1oZWlnaHQ6MThweDt2ZXJ0aWNhbC1hbGlnbjp0b3A7Zm9udC1zaXplOj0KMTBwdCIgd2lkdGg9M0QiMzAlIiB2YWxpZ249M0QidG9wIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0zRCJmb250LXNpemU6MTBwdCI+SlByb2Zlc3Npb25hbHM9QzI9QTBBUzxzPQpwYW4+PGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9M0QiZm9udC1zaXplOjEwcHQiPjxiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPTNEImh0dHBzOi8vanByby5ubyIgY29sb3I9M0QiIzA9CjAwMDAwIiBzdHlsZT0zRCJ0ZXh0LWRlY29yYXRpb246bm9uZTtjb2xvcjojZmY3YTBjIiByZWw9M0Qibm9vcGVuZXIiIHRhcmdldD0KPTNEIl9ibGFuayI+anByby5ubzwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2I+PC9zcGFuPgogICAgICAgICAgICAgICAgPC9zcGFuPjwvc3Bhbj48L3RkPjwvdHI+PC90Ym9keT48L3RhYmxlPjwvZGl2PjwvZGl2PjwvZGl2Pjw9Ci9kaXY+PC9kaXY+Cgo8cD48L3A+CgotLSA8YnIgLz4KWW91IHJlY2VpdmVkIHRoaXMgbWVzc2FnZSBiZWNhdXNlIHlvdSBhcmUgc3Vic2NyaWJlZCB0byB0aGUgR29vZ2xlIEdyb3VwcyAmPQpxdW90O3V0bHlzbmluZ2VyJnF1b3Q7IGdyb3VwLjxiciAvPgpUbyB1bnN1YnNjcmliZSBmcm9tIHRoaXMgZ3JvdXAgYW5kIHN0b3AgcmVjZWl2aW5nIGVtYWlscyBmcm9tIGl0LCBzZW5kIGFuIGU9Cm1haWwgdG8gPGEgaHJlZj0zRCJtYWlsdG86dXRseXNuaW5nZXIrdW5zdWJzY3JpYmVAanByby5ubyI+dXRseXNuaW5nZXIrdW5zdT0KYnNjcmliZUBqcHJvLm5vPC9hPi48YnIgLz4KCi0tMDAwMDAwMDAwMDAwYTZhOTQ3MDVmYzg0YTNiMi0t\",\"messageId\":\"7903264091104865\",\"message_id\":\"7903264091104865\",\"publishTime\":\"2023-05-25T13:31:37.648Z\",\"publish_time\":\"2023-05-25T13:31:37.648Z\"},\"subscription\":\"projects/my-page-jpro-test/subscriptions/eventarc-europe-west1-email-validator-099697-sub-906\"}";

    CloudEvent event =
        CloudEventBuilder.v1()
            .withId("0")
            .withType("pubsub.message")
            .withSource(URI.create("https://example.com"))
            .withData(message.getBytes(StandardCharsets.UTF_8))
            .build();

    new EmailValidatorFunction().accept(event);

    assertThat(logHandler.getStoredLogRecords().get(0).getMessage())
            .isEqualTo("Raw event data: " + message);
    assertThat(logHandler.getStoredLogRecords().stream().anyMatch(log -> log.getMessage().equals("ALL VALIDATIONS SUCCESSFUL")))
            .isTrue();
  }
}
