<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="200.028.001" author="claude">
        <comment>Initialize AvailabilityHistory for existing ConsultantAvailability records</comment>
        <sql>
            INSERT INTO availability_history (consultant_id, from_status, to_status, changed_at, changed_by_id)
            SELECT
                ca.consultant_id,
                NULL,
                ca.status,
                COALESCE(ca.updated_at, NOW()),
                ca.updated_by_id
            FROM consultant_availability ca
            WHERE NOT EXISTS (
                SELECT 1 FROM availability_history ah
                WHERE ah.consultant_id = ca.consultant_id
            )
        </sql>
    </changeSet>

</databaseChangeLog>
